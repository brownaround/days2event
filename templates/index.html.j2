{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="style.css" />
{% endblock %}
{% block content %}
<nav class="navbar">
  <div class="nav-container">
    <div class="logo">🎉 Days2Event</div>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
    <div class="button-group">
      <a href="{{ event['Link'] }}" target="_blank" rel="noopener" class="details-btn">Official Site</a>
      {% if event.Slug %}
       <a href="{{ event.Slug }}.html" class="details-btn">🎟 View Details</a>
      {% endif %}
    </div>
    <ul class="nav-links" id="navMenu">
      <li><a href="#" data-filter="all">✨ Multi-Genre</a></li>
      <li><a href="#" data-filter="genre" data-value="EDM">🪩 EDM</a></li>
      <li class="has-submenu">
        <a href="#" data-filter="genre" data-value="POP">🎶 POP</a>
        <ul class="submenu">
          {% for artist in genre_artists.get('POP', []) %}
          <li><a href="#" data-filter="artist" data-value="{{ artist }}">{{ artist }}</a></li>
          {% endfor %}
        </ul>
      </li>
      <li class="has-submenu">
        <a href="#" data-filter="genre" data-value="K-POP">🇰🇷🎵 K-POP</a>
        <ul class="submenu">
          {% for artist in genre_artists.get('K-POP', []) %}
          <li><a href="#" data-filter="artist" data-value="{{ artist }}">{{ artist }}</a></li>
          {% endfor %}
        </ul>
      </li>
      <li><a href="#" data-filter="genre" data-value="PRIDE">🏳️‍🌈 PRIDE</a></li>
      <li class="has-submenu">
        <a href="#" data-filter="region">📍 By Region</a>
        <ul class="submenu">
          {% for continent, regions in continent_regions.items() %}
          <li class="has-submenu">
            <a href="#" data-filter="continent" data-value="{{ continent }}">{{ continent }}</a>
            <ul class="submenu">
              {% for region in regions %}
              <li><a href="#" data-filter="region" data-value="{{ region }}">{{ region }}</a></li>
              {% endfor %}
            </ul>
          </li>
          {% endfor %}
        </ul>
      </li>
    </ul>
  </div>
</nav>

<header class="hero" id="hero-section">
  {% if selected_genre == 'POP' %}
    <h1>🎶 Dive into the World of POP Festivals!</h1>
    <p>Discover the hottest pop music events near you.</p>
  {% elif selected_genre == 'K-POP' %}
    <h1>🇰🇷🎵 K-POP Mania Starts Here!</h1>
    <p>Stay updated with the biggest K-POP festivals worldwide.</p>
  {% elif selected_genre == 'PRIDE' %}
    <h1>🏳️‍🌈 Celebrate Love & Music at PRIDE Festivals!</h1>
    <p>Join vibrant pride events full of music and unity.</p>
  {% else %}
    <h1>🌟 Your Festival Countdown Starts Here!</h1>
    <p>From Coachella to Tomorrowland – track how many days are left until the music starts!</p>
  {% endif %}
  <a href="#events" class="cta-btn">👇🏼 Browse Festivals</a>
</header>

<main class="events" id="events">
  {% for event in events %}
  <div class="event-card"
       data-genre="{{ event['Genre'] }}"
       data-region="{{ event['Region'] }}"
       data-continent="{{ event['Continent'] }}"
       data-artist="{{ event['Artist'] }}"
       data-date="{{ event['Start Date'] }}">
    <h2>{{ event['Festival Name'] }}</h2>
    <p>{{ event['Start Date'] }} - {{ event['End Date'] }} · {{ event['City'] }}, {{ event['Country'] }}</p>
    <div class="countdown-wrapper">
      <button class="reveal-btn">📆 Click to check</button>
      <div class="countdown hidden">⏳ <strong>Loading...</strong></div>
    </div>
    <a href="{{ event['Link'] }}" target="_blank" rel="noopener" class="details-btn">Official Site</a>
    <a href="{{ event.Slug }}.html" class="details-btn">🎟 View Details</a>
  </div>
  {% endfor %}
</main>

<footer>
  <p>© 2025 Days2Event · All rights reserved</p>
</footer>

<script>
function toggleMenu() {
  const nav = document.getElementById("navMenu");
  nav.classList.toggle("show");
}

const navLinks = document.querySelectorAll("#navMenu a");
const cards = [...document.querySelectorAll(".event-card")];

function setActiveLink(activeLink) {
  navLinks.forEach(link => link.classList.remove("active"));
  if (activeLink) activeLink.classList.add("active");
}

function filterCards(filterType, filterValue) {
  if (!filterType || filterType === "all") {
    cards.forEach(card => card.style.display = "block");
    return;
  }
  cards.forEach(card => {
    let show = false;
    switch(filterType) {
      case "genre":
        show = card.dataset.genre === filterValue;
        break;
      case "artist":
        show = card.dataset.artist === filterValue;
        break;
      case "continent":
        show = card.dataset.continent === filterValue;
        break;
      case "region":
        show = card.dataset.region === filterValue;
        break;
    }
    card.style.display = show ? "block" : "none";
  });
}

navLinks.forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const filterType = e.target.dataset.filter;
    const filterValue = e.target.dataset.value;
    filterCards(filterType, filterValue);
    setActiveLink(e.target);
  });
});

// countdown buttons
cards.forEach(card => {
  const btn = card.querySelector(".reveal-btn");
  const countdown = card.querySelector(".countdown");
  const dateStr = card.getAttribute("data-date");
  const targetDate = new Date(dateStr);
  const today = new Date();
  const oneDay = 1000 * 60 * 60 * 24;
  const daysLeft = Math.ceil((targetDate.setHours(0,0,0,0) - today.setHours(0,0,0,0)) / oneDay);
  btn.addEventListener("click", () => {
    countdown.querySelector("strong").textContent = daysLeft > 0
      ? `${daysLeft} days left`
      : daysLeft === 0
        ? `Today! 🎉`
        : `Passed 💤`;
    countdown.classList.remove("hidden");
    countdown.classList.add("reveal-animation");
    btn.style.display = "none";
  });
});
</script>
{% endblock %}
