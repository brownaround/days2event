{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="style.css" />
{% endblock %}
{% block content %}
<nav class="navbar">
  <div class="nav-container">
    <div class="logo" onclick="showHome()">ğŸ‰ Days2Event</div>
    <div class="hamburger" onclick="toggleMenu()">â˜°</div>
    <ul class="nav-links" id="navMenu">
      <li><a href="#" data-filter="multi-genre" class="active">âœ¨ Multi-Genre</a></li>
      <li><a href="#" data-filter="genre" data-value="EDM">ğŸª© EDM</a></li>
      <li><a href="#" data-filter="genre" data-value="POP">ğŸ¶ POP</a></li>
      <li><a href="#" data-filter="genre" data-value="K-POP">ğŸ‡°ğŸ‡·ğŸµ K-POP</a></li>
      <li><a href="#" data-filter="genre" data-value="PRIDE">ğŸ³ï¸â€ğŸŒˆ PRIDE</a></li>
      <li><a href="#" data-filter="region">ğŸ“ By Region</a></li>
    </ul>
  </div>
</nav>

<header class="hero" id="hero-section">
  <h1>ğŸŒŸ Your Festival Countdown Starts Here!</h1>
  <p>From Coachella to Tomorrowland â€“ track how many days are left until the music starts!</p>
  <a href="#events" class="cta-btn">ğŸ‘‡ğŸ¼ Browse Festivals</a>
</header>

<div class="tab-menu" id="tabMenu" style="padding: 0 2rem;">
  <button class="tab-btn active" data-tab="pop">ğŸ¶ POP</button>
  <button class="tab-btn" data-tab="kpop">ğŸ‡°ğŸ‡·ğŸµ K-POP</button>
  <button class="tab-btn" data-tab="region">ğŸ“ By Region</button>
</div>

<div class="tab-content active" id="pop" style="padding: 0 2rem;">
  <ul>
    {% for artist in genre_artists.get('POP', []) %}
    <li>{{ artist }}</li>
    {% endfor %}
  </ul>
</div>
<div class="tab-content" id="kpop" style="padding: 0 2rem;">
  <ul>
    {% for artist in genre_artists.get('K-POP', []) %}
    <li>{{ artist }}</li>
    {% endfor %}
  </ul>
</div>
<div class="tab-content" id="region" style="padding: 0 2rem;">
  <ul>
    {% for region in region_groups.keys() %}
    <li>{{ region }}</li>
    {% endfor %}
  </ul>
</div>

<main class="events" id="events">
  {% for event in events %}
  <div class="event-card"
       data-genre="{{ event['Genre'] }}"
       data-region="{{ event['Region'] }}"
       data-artist="{{ event['Artist'] }}"
       data-date="{{ event['Start Date'] }}"
       data-multi-genre="{{ 'yes' if ',' in event['Genre'] else 'no' }}">
    <h2>{{ event['Festival Name'] }}</h2>
    <p>
      {{ countryToEmoji(event['Country']) }} {{ event['Start Date'] }} - {{ event['End Date'] }} Â· {{ event['City'] }}, {{ event['Country'] }}
    </p>
    <div class="countdown-wrapper">
      <button class="reveal-btn">â³ How many days left?</button>
      <div class="countdown hidden">â³ <strong>Loading...</strong></div>
    </div>
    <a href="{{ event['Link'] }}" target="_blank" rel="noopener" class="details-btn">Official Site</a>
  </div>
  {% endfor %}
</main>

<footer>
  <p>Â© 2025 Days2Event Â· All rights reserved</p>
</footer>

<script>
function toggleMenu() {
  const nav = document.getElementById("navMenu");
  nav.classList.toggle("show");
}

// í™ˆ(ë¡œê³ ) í´ë¦­ì‹œ ì „ì²´ ì´ë²¤íŠ¸ ë³´ì´ë„ë¡ í•„í„°ë§ í•´ì œ
function showHome() {
  filterCards('all');
  setActiveLink(null);
}

// êµ­ê°€ëª… â†’ ì´ëª¨ì§€ ë³€í™˜ í•¨ìˆ˜
function countryToEmoji(country) {
  const countryMap = {
    "USA": "ğŸ‡ºğŸ‡¸",
    "United States": "ğŸ‡ºğŸ‡¸",
    "South Korea": "ğŸ‡°ğŸ‡·",
    "Korea": "ğŸ‡°ğŸ‡·",
    "Belgium": "ğŸ‡§ğŸ‡ª",
    "France": "ğŸ‡«ğŸ‡·",
    // í•„ìš”í•œ êµ­ê°€ ì¶”ê°€...
  };
  return countryMap[country] || country;
}

// ì´ë²¤íŠ¸ ì¹´ë“œ êµ­ê°€ëª… ì´ëª¨ì§€ ì¹˜í™˜ (í…œí”Œë¦¿ ë Œë”ë§ ì¤‘ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŒ)
document.querySelectorAll('.event-card p').forEach(p => {
  let text = p.textContent;
  for (const [key, emoji] of Object.entries({
    "USA": "ğŸ‡ºğŸ‡¸",
    "United States": "ğŸ‡ºğŸ‡¸",
    "South Korea": "ğŸ‡°ğŸ‡·",
    "Korea": "ğŸ‡°ğŸ‡·",
    "Belgium": "ğŸ‡§ğŸ‡ª",
    "France": "ğŸ‡«ğŸ‡·"
  })) {
    text = text.replace(new RegExp(key, 'g'), emoji);
  }
  p.textContent = text;
});

const navLinks = document.querySelectorAll("#navMenu a");
const cards = [...document.querySelectorAll(".event-card")];

function setActiveLink(activeLink) {
  navLinks.forEach(link => link.classList.remove("active"));
  if (activeLink) activeLink.classList.add("active");
}

function filterCards(filterType, filterValue) {
  let visibleCards = [];
  switch(filterType) {
    case 'all':
      visibleCards = cards;
      break;
    case 'multi-genre':
      visibleCards = cards.filter(card => card.dataset.multiGenre === 'yes');
      break;
    case 'genre':
      visibleCards = cards.filter(card => card.dataset.genre === filterValue);
      break;
    case 'artist':
      visibleCards = cards.filter(card => card.dataset.artist === filterValue);
      break;
    case 'region':
      visibleCards = cards.filter(card => card.dataset.region === filterValue);
      break;
    default:
      visibleCards = cards;
  }
  cards.forEach(card => card.style.display = "none");
  visibleCards.slice(0,4).forEach(card => card.style.display = "block");
}

navLinks.forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const filterType = e.target.dataset.filter;
    const filterValue = e.target.dataset.value;
    filterCards(filterType, filterValue);
    setActiveLink(e.target);

    const nav = document.getElementById("navMenu");
    if(nav.classList.contains("show")){
      nav.classList.remove("show");
    }
  });
});

// íƒ­ ë©”ë‰´ ë¡œì§
const tabs = document.querySelectorAll('.tab-btn');
const contents = document.querySelectorAll('.tab-content');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    contents.forEach(c => c.classList.remove('active'));
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

// ì¹´ìš´íŠ¸ë‹¤ìš´ ë²„íŠ¼ ë° ì§€ë‚œ ì´ë²¤íŠ¸ ìˆ¨ê¸°ê¸°
cards.forEach(card => {
  const btn = card.querySelector(".reveal-btn");
  const countdown = card.querySelector(".countdown");
  const dateStr = card.getAttribute("data-date");
  const targetDate = new Date(dateStr);
  const today = new Date();
  const oneDay = 1000 * 60 * 60 * 24;
  const daysLeft = Math.ceil((targetDate.setHours(0,0,0,0) - today.setHours(0,0,0,0)) / oneDay);

  if (daysLeft < 0) {
    card.style.display = "none";
  }

  btn.addEventListener("click", () => {
    countdown.querySelector("strong").textContent = daysLeft > 0
      ? `${daysLeft} days left`
      : daysLeft === 0
        ? `Today! ğŸ‰`
        : `Passed ğŸ’¤`;
    countdown.classList.remove("hidden");
    countdown.classList.add("reveal-animation");
    btn.style.display = "none";
    card.style.display = "block";
  });
});
</script>
{% endblock %}
