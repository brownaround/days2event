{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="style.css" />
{% endblock %}
{% block content %}
<h1>ğŸ‰ Days2Event</h1>
<main class="events" id="events">
  {% for event in events %}
  <div class="event-card" data-date="{{ event['Start Date'] }}">
    <h2>{{ event['Festival Name'] }}</h2>
    <h3>Artist: {{ event['Aritist'] }}</h3>
    <p>{{ event['Start Date'] }} - {{ event['End Date'] }} Â· {{ event['City'] }}, {{ event['Country'] }}</p>
    <div class="countdown-wrapper">
      <button class="reveal-btn">ğŸ“† Click to check</button>
      <div class="countdown hidden">â³ <strong>Loading...</strong></div>
    </div>
    <a href="{{ event['Link'] }}" target="_blank" rel="noopener" class="details-btn">Official Site</a>
  </div>
  {% endfor %}
</main>
<script>
  const container = document.getElementById("events");
  const cards = Array.from(container.querySelectorAll('.event-card'));
  cards.sort((a, b) => new Date(a.dataset.date) - new Date(b.dataset.date));
  container.innerHTML = '';
  cards.forEach(card => container.appendChild(card));
  cards.forEach(card => {
    const btn = card.querySelector('.reveal-btn');
    const countdown = card.querySelector('.countdown');
    const dateStr = card.getAttribute('data-date');
    const targetDate = new Date(dateStr);
    const today = new Date();
    const oneDay = 1000 * 60 * 60 * 24;
    const daysLeft = Math.ceil((targetDate.setHours(0,0,0,0) - today.setHours(0,0,0,0)) / oneDay);
    btn.addEventListener('click', () => {
      countdown.querySelector('strong').textContent = daysLeft > 0
        ? `${daysLeft} days left`
        : daysLeft === 0
          ? `Today! ğŸ‰`
          : `Passed ğŸ’¤`;
      countdown.classList.remove('hidden');
      countdown.classList.add('reveal-animation');
      btn.style.display = 'none';
    });
  });
</script>
{% endblock %}
