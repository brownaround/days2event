{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="style.css" />
{% endblock %}

{% block content %}

<header class="hero {% if current_page %}{{ current_page }}{% endif %}" id="hero-section">
  <h1>
    {% if current_page == 'multi-genre' %}
      Multi-Genre Festivals
    {% elif current_page == 'edm' %}
      EDM Festivals
    {% elif current_page == 'pride' %}
      PRIDE Festivals
    {% elif current_page == 'pop' %}
      POP Festivals
    {% elif current_page == 'kpop' %}
      K-POP Festivals
    {% elif current_page == 'region' %}
      By Region Festivals
    {% else %}
      {{ hero_title }}
    {% endif %}
  </h1>
  <p>
    {% if current_page == 'multi-genre' %}
      Explore diverse music festivals worldwide.
    {% elif current_page == 'edm' %}
      Feel the beat at top EDM events.
    {% elif current_page == 'pride' %}
      Celebrate diversity and love with PRIDE events.
    {% else %}
      {{ hero_subtitle }}
    {% endif %}
  </p>
  <a href="#events" class="browse-btn">ğŸ‘‡ğŸ¼ Browse Festivals</a>
</header>


{% if current_page == 'pop' %}
{% set artists = genre_artists.get('POP', []) %}
<div class="subnav-buttons">
  <a href="pop.html?artist=all" class="subnav-btn{% if selected=='all' %} active{% endif %}">All</a>
  {% for artiste in artists %}
    <a href="pop.html?artist={{ artiste }}" class="subnav-btn{% if selected==artiste %} active{% endif %}">{{ artiste }}</a>
  {% endfor %}
</div>
{% endif %}
{% if current_page == 'kpop' %}
{% set artists = genre_artists.get('K-POP', []) %}
<div class="subnav-buttons">
  <a href="k-pop.html?artist=all" class="subnav-btn{% if selected=='all' %} active{% endif %}">All</a>
  {% for artiste in artists %}
    <a href="k-pop.html?artist={{ artiste }}" class="subnav-btn{% if selected==artiste %} active{% endif %}">{{ artiste }}</a>
  {% endfor %}
</div>
{% endif %}
{% if current_page == 'region' %}
<div class="region-buttons">
  <a href="asia.html" class="region-btn{% if selected=='asia' %} active{% endif %}" data-region="asia">ğŸŒ Asia</a>
  <a href="europe.html" class="region-btn{% if selected=='europe' %} active{% endif %}" data-region="europe">ğŸ° Europe</a>
  <a href="latin-america.html" class="region-btn{% if selected=='latin-america' %} active{% endif %}" data-region="latin-america">ğŸ‰ Latin America</a>
  <a href="north-america.html" class="region-btn{% if selected=='north-america' %} active{% endif %}" data-region="north-america">ğŸ—½ North America</a>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
  let regionKey = 'asia';
  if (tz.startsWith('Europe')) regionKey = 'europe';
  else if (tz.startsWith('America')) regionKey = 'north-america';
  document.querySelectorAll('.region-btn').forEach(btn => btn.classList.remove('active'));
  const activeBtn = document.querySelector(`.region-btn[data-region="${regionKey}"]`);
  if (activeBtn) activeBtn.classList.add('active');
});
</script>
{% endif %}

</div>

<div class="tab-content active" id="{{ current_page }}" style="padding: 0 2rem;">
  <ul>
    {% if current_page == 'pop' %}
      {% for artist in genre_artists.get('POP', []) %}
      <li>{{ artist }}</li>
      {% endfor %}
    {% elif current_page == 'kpop' %}
      {% for artist in genre_artists.get('K-POP', []) %}
      <li>{{ artist }}</li>
      {% endfor %}
    {% elif current_page == 'region' %}
      {% for region in region_groups if region %}
      <li>{{ region }}</li>
      {% endfor %}
    {% endif %}
  </ul>
</div>
{% endif %}

<main class="events" id="events">

  {% for event in events %}
    {% if not (current_page == 'multi-genre' and event['Genre'] != 'Multi-Genre') %}
      <div class="event-card"
           data-genre="{{ event['Genre'] }}"
           data-region="{{ event['Region'] }}"
           data-artist="{{ event['Artist'] }}"
           data-date="{{ event['Start Date'] }}"
           data-multi-genre="{{ 'yes' if event['Genre'] == 'Multi-Genre' else 'no' }}">
        <h2>{{ event['Festival Name'] }}</h2>
        <p>
          {{ event['Start Date']|formatDateRange(event['End Date']) }} Â· {{ event['City'] }} {{ countryToEmoji(event['Country']) }}
        </p>
        <div class="countdown-wrapper">
          <button class="reveal-btn">â³ How many days left?</button>
          <div class="countdown hidden">â³ <strong>Loading...</strong></div>
        </div>
        <a href="{{ event['Link'] }}" target="_blank" rel="noopener" class="details-btn">Official Site</a>
      </div>
    {% endif %}
  {% endfor %}

</main>

<footer>
  <p>Â© 2025 Days2Event Â· All rights reserved</p>
</footer>

<script>
const navLinks = document.querySelectorAll("#navMenu a");
const cards = [...document.querySelectorAll(".event-card")];

function setActiveButton(button) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  if (button) button.classList.add('active');
}

function filterCards(filterType, filterValue) {
  let visibleCards = [];
  switch(filterType) {
    case 'all':
      visibleCards = cards;
      break;
    case 'multi-genre':
      visibleCards = cards.filter(card => card.dataset.multiGenre === 'yes');
      break;
    case 'genre':
      visibleCards = cards.filter(card => card.dataset.genre === filterValue);
      break;
    case 'artist':
      visibleCards = cards.filter(card => card.dataset.artist === filterValue);
      break;
    case 'region':
      visibleCards = cards.filter(card => card.dataset.region === filterValue);
      break;
    default:
      visibleCards = cards;
  }
  cards.forEach(card => card.style.display = "none");
  visibleCards.forEach(card => card.style.display = "block");
}

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const filterType = btn.dataset.filter;
    const filterValue = btn.dataset.value;
    filterCards(filterType, filterValue);
    setActiveButton(btn);
  });
});

// Countdown button logic
cards.forEach(card => {
  const btn = card.querySelector(".reveal-btn");
  const countdown = card.querySelector(".countdown");
  const dateStr = card.getAttribute("data-date");
  const targetDate = new Date(dateStr);
  const today = new Date();
  const oneDay = 1000 * 60 * 60 * 24;
  const daysLeft = Math.ceil((targetDate.setHours(0,0,0,0) - today.setHours(0,0,0,0)) / oneDay);

  if (daysLeft < 0) {
    card.style.display = "none";
  }

  btn.addEventListener("click", () => {
    countdown.querySelector("strong").textContent = daysLeft > 0
      ? `${daysLeft} days left`
      : daysLeft === 0
        ? `Today! ğŸ‰`
        : `Passed ğŸ’¤`;
    countdown.classList.remove("hidden");
    countdown.classList.add("reveal-animation");
    btn.style.display = "none";
    card.style.display = "block";
  });
});
</script>

{% endblock %}
